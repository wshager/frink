{"version":3,"sources":["../src/typed.js"],"names":["check","checked","f","a","t","hasOwnProperty","__wraps","Error","TypeError","constructor","name","errorMessage","i","pos","key","noKey","io","typePart","JSON","stringify","occurrence","test","occ","err","__occurrence","any","id","many","oneOrMore","maybe","zeroOrOne","single","exactlyOne","unwrap","fn","args","s","r","sl","al","hasRestParam","o","argLengthError","ret","subscribe","unwrapMaybe","value","next","error","complete","bind","unwrapSingle","__rest_param","item","c","getStack","orig","prepareStackTrace","_","stack","captureStackTrace","def","length","st","getFunctionName","getFileName","getLineNumber","getColumnNumber","__length","array","x","map","atomic","b","isNumeric","numeric","restParams"],"mappings":"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","sourcesContent":["import { seq, isSeq, create, forEach } from \"./seq\";\n\nimport { exactlyOne, zeroOrOne, oneOrMore } from \"./seq/card\";\n\nimport { id, isUndef, isList, isMap } from \"./util\";\n\nimport { array as makeArray } from \"./array\";\n\nimport { map as makeMap } from \"./map\";\n\n// TODO make configurable\nconst check = true;\n\n// we know typed will take a function and test it,\n// so we can use the same function here to bind the subscriber\n// we should run two tests:\n// 1. the cardinality\n// 2. the actual type\n// furthermore, we should\n// 3. unwrap Maybe (allowing nulls or preventing type tests) and Single\n// 4. connect types for Flowable to subscriber\n\n// wrap card + type, if isSeq, don't perform type test, but bind to subscriber:\n\nconst checked = (f,a) => {\n\tconst t = f(a);\n\tif(typeof t == \"function\" && t.hasOwnProperty(\"__wraps\")) {\n\t\tif(t.__wraps !== a) throw new Error(\"unknown function found\");\n\t} else {\n\t\tif(a !== t) throw new TypeError(\"Incorrect type: expected \"+t.constructor.name+\", got \"+a.constructor.name);\n\t}\n\treturn t;\n};\n\n\nconst errorMessage = (a,name,i,pos,key) => {\n\tif(isUndef(a) || isUndef(name)) return \"Invalid value\\n\";\n\tconst noKey = isUndef(key);\n\tif(noKey) key = \"argument\";\n\tconst io = i < 0 ? \"output\" : key+\" \"+(typeof i == \"string\" ? `\"${i}\"` :  i);\n\tconst typePart = noKey ? `for function '${name}'\\n    at ${pos[0]} (${pos[1]}:${pos[2]}:${pos[3]})` : `found in ${name}`;\n\treturn \"Invalid \"+io+\" *\"+JSON.stringify(a)+\"* \"+typePart + \"\\n\";\n};\n\nexport const occurrence = (test,occ) => f => {\n\tconst t = (a,name,i,pos,key) => forEach(a,a => {\n\t\ttry {\n\t\t\treturn checked(f, test(a));\n\t\t} catch(err) {\n\t\t\tthrow new Error(errorMessage(a,name,i,pos,key)+err);\n\t\t}\n\t});\n\tt.__occurrence = occ;\n\treturn t;\n};\nexport const any = occurrence(id,1);\nexport const many = occurrence(oneOrMore,2);\nexport const maybe = occurrence(zeroOrOne,3);\nexport const single = occurrence(exactlyOne,4);\n\nfunction unwrap(fn,args,s,r,name,pos,sl,al,hasRestParam,i,o) {\n\tif(i === al) {\n\t\tif(hasRestParam) sl--;\n\t\tif(sl > i) {\n\t\t\tthrow argLengthError(name,sl,al,hasRestParam);\n\t\t}\n\t\tconst ret = fn();\n\t\treturn o ? seq(ret).subscribe(o) : ret;\n\t}\n\tconst unwrapMaybe = o => a => {\n\t\tlet value = null;\n\t\ta.subscribe({\n\t\t\tnext(a) {\n\t\t\t\tvalue = a;\n\t\t\t},\n\t\t\terror(err) {\n\t\t\t\to.error(err);\n\t\t\t},\n\t\t\tcomplete() {\n\t\t\t\tunwrap(fn.bind(null,value),args,s,r,name,pos,sl,al,hasRestParam,i+1,o);\n\t\t\t}\n\t\t});\n\t};\n\tconst unwrapSingle = o => a => a.subscribe({\n\t\tnext(a) {\n\t\t\tunwrap(fn.bind(null,a),args,s,r,name,pos,sl,al,hasRestParam,i+1,o);\n\t\t},\n\t\terror(err) {\n\t\t\to.error(err);\n\t\t}\n\t});\n\tlet f = s[i];\n\t// TODO check optional and adapt length\n\tif(isUndef(f) || f.__rest_param) {\n\t\t// try last\n\t\tif(hasRestParam) {\n\t\t\tf = sl > 1 ? s[sl - 2] : any(item());\n\t\t} else {\n\t\t\tthrow argLengthError(name,sl,al,hasRestParam);\n\t\t}\n\t}\n\tconst c = f.__occurrence;\n\tif(isUndef(c)) f = single(f);\n\tconst a = check ? f(args[i],name,i,pos) : args[i];\n\tif(isSeq(a)) {\n\t\t// when we unwrap we get back an Observable, not a function...\n\t\tif(c === 3) {\n\t\t\tif(!o) {\n\t\t\t\treturn create(o => {\n\t\t\t\t\tunwrapMaybe(o)(a);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn unwrapMaybe(o)(a);\n\t\t\t}\n\t\t} else if(c === 4) {\n\t\t\tif(!o) {\n\t\t\t\treturn create(o => {\n\t\t\t\t\tunwrapSingle(o)(a);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn unwrapSingle(o)(a);\n\t\t\t}\n\t\t}\n\t}\n\treturn unwrap(fn.bind(null,a),args,s,r,name,pos,sl,al,hasRestParam,i+1,o);\n}\n\n// TODO use separate cross-browser package conditionally\nfunction getStack(){\n\tvar orig = Error.prepareStackTrace;\n\tError.prepareStackTrace = function(_, stack) {\n\t\treturn stack;\n\t};\n\tvar err = new Error;\n\tError.captureStackTrace(err);\n\tvar stack = err.stack;\n\tError.prepareStackTrace = orig;\n\treturn stack;\n}\n\nfunction argLengthError(name,sl,al,hasRestParam) {\n\treturn new Error(`Invalid number of arguments for function ${name}. Expected ${hasRestParam ? \"at least\" : \"\"} ${sl} got ${al}`);\n}\n\nexport const def = (name,s,r,pos) => {\n\tconst sl = s ? s.length : -1;\n\tif(r) {\n\t\tconst c = r.__occurrence;\n\t\tif(isUndef(c)) r = single(r);\n\t}\n\tconst hasRestParam = sl > 0 && s[sl - 1].__rest_param;\n\tconst f = fn => {\n\t\tif(typeof fn !== \"function\") throw new TypeError(\"Invalid argument for function 'def'\\nExpected a Function, got a \"+fn.constructor.name);\n\t\tif(isUndef(pos)) {\n\t\t\tvar st = getStack()[2];\n\t\t\tpos = [st.getFunctionName(),st.getFileName(),st.getLineNumber(),st.getColumnNumber()];\n\t\t}\n\t\tconst f = (...args) => {\n\t\t\tconst al = args.length;\n\t\t\tconst ret = unwrap(fn,args,s,r,name,pos,sl,al,hasRestParam,0);\n\t\t\treturn check ? forEach(ret, a => r(a,name,-1,pos)) : ret;\n\t\t};\n\t\tf.__wraps = fn;\n\t\treturn f;\n\t};\n\tf.__length = hasRestParam ? -1 : sl;\n\treturn f;\n};\n\nexport const array = f => a => {\n\tif(!isList(a)) return makeArray();\n\tlet i = 0;\n\tfor(let x of a) {\n\t\tf(x,\"array\",i++,[],\"value at index\");\n\t}\n\treturn a;\n};\n\nexport const map = f => a => {\n\tif(!isMap(a)) return makeMap();\n\tlet i = 0;\n\tfor(let x of a) {\n\t\tf(x,\"map\",i++,[],\"value at key\");\n\t}\n\treturn a;\n};\n\nexport const item = () => id;\n\nexport const atomic = () => a => {\n\t// boolean / string / numeric\n\tlet t = typeof a;\n\tif(t === \"string\" || t === \"number\" || t === \"boolean\") return a;\n\tconst b = a.constructor;\n\treturn isNumeric(a,b) ? a : new b();\n};\n\nconst isNumeric = (a,b) => {\n\tswitch(b.name) {\n\tcase \"Integer\":\n\tcase \"Number\":\n\tcase \"Float\":\n\tcase \"Decimal\":\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n};\n\nexport const numeric = () => a => {\n\tconst b = a.constructor;\n\treturn isNumeric(a,b) ? a : new b();\n};\n\nexport const restParams = () => {\n\treturn {__rest_param:true};\n};\n"],"file":"typed.js"}