{"version":3,"sources":["../src/function.js"],"names":["modules","loadModule","$moduleUri","concatMap","moduleUri","map","default","require","functionLookup","$qname","$arity","qname","arity","uri","toString","name","split","pop","fn","apply","$fn","$a","concatAll","toArray","a","sort","$s","crit","b","hasComp","gt","lt"],"mappings":";;;;;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;;;AAEA,MAAMA,UAAU;AACf,4CAAyC;AAD1B,CAAhB;;AAIO,SAASC,UAAT,CAAoBC,UAApB,EAAgC;AACtC;AACA;AACA;AACA,SAAO,sBAAWA,UAAX,EAAuBC,SAAvB,CAAiCC,aAAaC,IAAIC,OAAJ,CAAYC,QAAQP,QAAQI,SAAR,CAAR,CAAZ,CAA9C,CAAP;AACA;;AAEM,SAASI,cAAT,CAAwBC,MAAxB,EAA+BC,MAA/B,EAAsC;AAC5C,SAAO,sBAAWD,MAAX,EAAmBN,SAAnB,CAA6BQ,SAAS;AAC5C,WAAO,sBAAWD,MAAX,EAAmBP,SAAnB,CAA6BS,SAAS;AAC5C,UAAIC,MAAMF,MAAME,GAAN,CAAUC,QAAV,EAAV;AACA,UAAIC,OAAO,qBAAUJ,MAAMI,IAAN,CAAWD,QAAX,GAAsBE,KAAtB,CAA4B,GAA5B,EAAiCC,GAAjC,EAAV,CAAX;AACA,UAAIC,KAAKlB,QAAQa,GAAR,EAAaE,OAAK,GAAL,GAASH,KAAtB,CAAT;AACA,UAAG,CAACM,EAAJ,EAAQA,KAAKlB,QAAQa,GAAR,EAAaE,OAAK,GAAlB,CAAL;AACR,aAAOG,KAAK,cAAIA,EAAJ,CAAL,GAAe,eAAtB;AACA,KANM,CAAP;AAOA,GARM,CAAP;AASA;;AAEM,SAASC,KAAT,CAAeC,GAAf,EAAmBC,EAAnB,EAAuB;AAC7B,SAAO,sBAAWD,GAAX,EAAgBjB,SAAhB,CAA0Be,MAAM,sBAAWG,EAAX,EAAeC,SAAf,GAA2BC,OAA3B,GAAqClB,GAArC,CAAyCmB,KAAKN,GAAGC,KAAH,CAAS,IAAT,EAAcK,CAAd,CAA9C,CAAhC,CAAP;AACA,C,CAED;;;AACO,SAASC,IAAT,CAAcC,EAAd,EAAiBN,GAAjB,EAAqB;AAC3B,MAAIO,OAAO,UAASH,CAAT,EAAWI,CAAX,EAAa;AACvB,UAAMC,UAAU,OAAOL,CAAP,IAAY,QAAZ,IAAwB,QAAQA,CAAhD;;AACA,UAAMM,KAAK,CAACN,CAAD,EAAGI,CAAH,KAASC,UAAUL,EAAEM,EAAF,CAAKF,CAAL,CAAV,GAAoBJ,IAAII,CAA5C;;AACA,UAAMG,KAAK,CAACP,CAAD,EAAGI,CAAH,KAASC,UAAUL,EAAEO,EAAF,CAAKH,CAAL,CAAV,GAAoBJ,IAAII,CAA5C;;AACA,WAAOE,GAAGN,CAAH,EAAKI,CAAL,IAAU,CAAV,GAAcG,GAAGP,CAAH,EAAKI,CAAL,IAAU,CAAC,CAAX,GAAe,CAApC;AACA,GALD;;AAMA,SAAO,cAAIF,EAAJ,EAAQH,OAAR,GAAkBpB,SAAlB,CAA4BqB,KAAK,mBAAQJ,GAAR,IAAe,cAAII,EAAEC,IAAF,CAAOE,IAAP,CAAJ,CAAf,GAAmC,cAAIP,GAAJ,EAASjB,SAAT,CAAmBe,MAAMM,EAAEC,IAAF,CAAOP,EAAP,CAAzB,CAApE,CAAP;AACA","sourcesContent":["import { seq } from \"./seq\";\r\n\r\nimport { exactlyOne } from \"./seq/card\";\r\n\r\nimport { isUndef, camelCase } from \"./util\";\r\n\r\nimport * as map from \"./map\";\r\n\r\nconst modules = {\r\n\t\"http://www.w3.org/2005/xpath-functions\":\"./function\"\r\n};\r\n\r\nexport function loadModule($moduleUri) {\r\n\t// conflict?\r\n\t//if (module.uri in modules) return;\r\n\t// let js manager handle logic\r\n\treturn exactlyOne($moduleUri).concatMap(moduleUri => map.default(require(modules[moduleUri])));\r\n}\r\n\r\nexport function functionLookup($qname,$arity){\r\n\treturn exactlyOne($qname).concatMap(qname => {\r\n\t\treturn exactlyOne($arity).concatMap(arity => {\r\n\t\t\tvar uri = qname.uri.toString();\r\n\t\t\tvar name = camelCase(qname.name.toString().split(/:/).pop());\r\n\t\t\tvar fn = modules[uri][name+\"$\"+arity];\r\n\t\t\tif(!fn) fn = modules[uri][name+\"$\"];\r\n\t\t\treturn fn ? seq(fn) : seq();\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function apply($fn,$a) {\r\n\treturn exactlyOne($fn).concatMap(fn => exactlyOne($a).concatAll().toArray().map(a => fn.apply(this,a)));\r\n}\r\n\r\n// FIXME check if seq + apply data\r\nexport function sort($s,$fn){\r\n\tvar crit = function(a,b){\r\n\t\tconst hasComp = typeof a == \"object\" && \"gt\" in a;\r\n\t\tconst gt = (a,b) => hasComp ? a.gt(b) : a > b;\r\n\t\tconst lt = (a,b) => hasComp ? a.lt(b) : a < b;\r\n\t\treturn gt(a,b) ? 1 : lt(a,b) ? -1 : 0;\r\n\t};\r\n\treturn seq($s).toArray().concatMap(a => isUndef($fn) ? seq(a.sort(crit)) : seq($fn).concatMap(fn => a.sort(fn)));\r\n}\r\n"],"file":"function.js"}