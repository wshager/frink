{"version":3,"sources":["../src/array-seq.js"],"names":["isArraySeq","s","__is_ArraySeq","ArraySeq","constructor","a","$array","merge","other","concat","first","map","fn","mergeMap","buffer","hasOb","i","l","length","ret","push","concatMap","mergeAll","x","concatAll","reduce","args","shift","slice","seed","zip","o","l2","v","filter","shareReplay","bufSize","subscribe","observer","forEach","next","complete","take","n","takeWhile","skip","skipWhile","isEmpty","count","toPromise","Promise","resolve","toObservable","toArray"],"mappings":"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","sourcesContent":["import { isObservable, from } from \"rxjs\";\r\n\r\nexport const isArraySeq = s => !!(s && s.__is_ArraySeq);\r\n\r\nexport class ArraySeq {\r\n\tconstructor(a = []) {\r\n\t\tthis.$array = a;\r\n\t\tthis.__is_ArraySeq = true;\r\n\t}\r\n\tmerge(other) {\r\n\t\treturn new ArraySeq(this.$array.concat(other.$array));\r\n\t}\r\n\tconcat(other) {\r\n\t\treturn this.merge(other);\r\n\t}\r\n\tfirst() {\r\n\t\treturn this.$array[0];\r\n\t}\r\n\tmap(fn) {\r\n\t\treturn new ArraySeq(this.$array.map(fn));\r\n\t}\r\n\tmergeMap(fn) {\r\n\t\tconst a = this.$array;\r\n\t\tconst buffer = [];\r\n\t\tlet hasOb = false;\r\n\t\tfor(var i=0, l = a.length; i<l; i++) {\r\n\t\t\tconst ret = fn(a[i],i);\r\n\t\t\tif(isArraySeq(ret)) {\r\n\t\t\t\tbuffer.push(...ret.$array);\r\n\t\t\t} else if(isObservable(ret)) {\r\n\t\t\t\tbuffer.push(ret);\r\n\t\t\t\thasOb = true;\r\n\t\t\t} else {\r\n\t\t\t\tbuffer.push(ret);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"B\",buffer);\r\n\t\treturn hasOb ? from(buffer) : new ArraySeq(buffer);\r\n\t}\r\n\tconcatMap(fn) {\r\n\t\treturn this.mergeMap(fn);\r\n\t}\r\n\tmergeAll() {\r\n\t\treturn this.mergeMap(x => x);\r\n\t}\r\n\tconcatAll() {\r\n\t\treturn this.mergeAll();\r\n\t}\r\n\treduce(...args) {\r\n\t\tconst fn = args.shift();\r\n\t\tconst a = this.$array.slice(0);\r\n\t\tlet seed = args.shift() || a.shift();\r\n\t\treturn new ArraySeq([a.reduce(fn,seed)]);\r\n\t}\r\n\tzip(other) {\r\n\t\tconst a = this.$array, o = other.$array, buffer = [], l = a.length, l2 = o.length;\r\n\t\tfor(let i=0; i<l; i++) {\r\n\t\t\tconst v = a[i];\r\n\t\t\tif(i < l2) buffer.push([v,o[i]]);\r\n\t\t}\r\n\t\treturn new ArraySeq(buffer);\r\n\t}\r\n\tfilter(fn) {\r\n\t\treturn new ArraySeq(this.$array.filter(fn));\r\n\t\t/*\r\n\t\tconst a = this.$array;\r\n\t\tconst buffer = [];\r\n\t\tfor(var i=0, l = a.length; i<l; i++) {\r\n\t\t\tconst v = a[i];\r\n\t\t\tconst ret = fn(v,i);\r\n\t\t\tif(!ret) continue;\r\n\t\t\tif(isArraySeq(v)) buffer.push(...v.$array);\r\n\t\t\telse buffer.push(v);\r\n\t\t}\r\n\t\treturn new ArraySeq(buffer);\r\n\t\t*/\r\n\t}\r\n\tshareReplay(bufSize) {\r\n\t\treturn new ArraySeq(this.$array.slice(0,bufSize));\r\n\t}\r\n\tsubscribe(observer) {\r\n\t\tif(typeof observer == \"function\") {\r\n\t\t\tthis.$array.forEach(x => observer(x));\r\n\t\t} else if(observer.next) {\r\n\t\t\tthis.$array.forEach(x => observer.next(x));\r\n\t\t\tobserver.complete();\r\n\t\t} else {\r\n\t\t\t//whatever\r\n\t\t}\r\n\t}\r\n\ttake(n) {\r\n\t\treturn new ArraySeq(this.$array.slice(0,n));\r\n\t}\r\n\ttakeWhile(fn) {\r\n\t\tconst a = this.$array, buffer = [];\r\n\t\tfor(var i=0, l = a.length; i<l; i++) {\r\n\t\t\tconst v = a[i];\r\n\t\t\tif(!fn(v,i)) break;\r\n\t\t\tbuffer.push(v);\r\n\t\t}\r\n\t\treturn new ArraySeq(buffer);\r\n\t}\r\n\tskip(n) {\r\n\t\treturn new ArraySeq(this.$array.slice(n));\r\n\t}\r\n\tskipWhile(fn) {\r\n\t\tconst a = this.$array, buffer = [];\r\n\t\tlet skip = true;\r\n\t\tfor(var i=0, l = a.length; i<l; i++) {\r\n\t\t\tconst v = a[i];\r\n\t\t\tif(skip && !fn(v,i)) skip = false;\r\n\t\t\tif(!skip) buffer.push(v);\r\n\t\t}\r\n\t\treturn new ArraySeq(buffer);\r\n\t}\r\n\tisEmpty() {\r\n\t\treturn !this.$array.length;\r\n\t}\r\n\tcount() {\r\n\t\treturn this.$array.length;\r\n\t}\r\n\ttoPromise() {\r\n\t\treturn Promise.resolve(this.first());\r\n\t}\r\n\ttoObservable() {\r\n\t\treturn from(this.$array);\r\n\t}\r\n\ttoArray() {\r\n\t\treturn new ArraySeq([this.$array]);\r\n\t}\r\n}\r\n"],"file":"array-seq.js"}