{"version":3,"sources":["../src/array.js"],"names":["List","rrb","empty","constructor","prototype","__is_List","_type","l","x","push","TreeIterator","call","$","$k","$v","len","arguments","length","get","set","module","exports","array","a","f","seqFoldLeft","iterFoldLeft","acc","reduce","join","$a","undefined","pre","cur","concat","head","tail","slice","size","count","subarray","s","Math","max","Number","insertBefore","i","v","pop","remove","append","reverse","fromArray","toJS","flatten","filter","fn","forEach","foldLeft","z"],"mappings":"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","sourcesContent":["import * as rrb from \"rrb-vector\";\n\nimport { error } from \"./error\";\n\nimport { from } from \"rxjs\";\n\nimport { isSeq, foldLeft as seqFoldLeft, forEach as seqForEach, filter as seqFilter } from \"./seq\";\n\nimport { foldLeft as iterFoldLeft } from \"./iter-util\";\n\n// TODO option: call ensureDoc and handle everything via VNode (i.e. persistent or not)\n//import { ensureDoc } from \"./doc\";\n\n//import { list } from \"./access\";\n\nimport { isUndef } from \"./util\";\n\nvar List = rrb.empty.constructor;\n\nList.prototype.__is_List = true;\n\nList.prototype._type = 5;\n\nList.prototype[\"@@transducer/init\"] = function(){\n\treturn rrb.empty;\n};\n\nList.prototype[\"@@transducer/step\"] = function(l,x) {\n\treturn l.push(x);\n};\n\nList.prototype[\"@@transducer/result\"] = function(l) {\n\treturn l;\n};\n\nrrb.TreeIterator.prototype[\"@@transducer/init\"] = function(){\n\treturn rrb.empty;\n};\n\nrrb.TreeIterator.prototype[\"@@transducer/step\"] = function(l,x) {\n\treturn l.push(x);\n};\n\nrrb.TreeIterator.prototype[\"@@transducer/result\"] = function(l) {\n\treturn l;\n};\n\n\nList.prototype.call = function($,$k,$v){\n\tconst len = arguments.length;\n\treturn len == 2 ? get(this,$k) : len == 3 ? set(this,$k,$v) : this;\n};\n\nmodule.exports.List = List;\n\nexport function array(...a) {\n\tconst l = a.length;\n\tif (l === 0) {\n\t\treturn rrb.empty;\n\t}\n\tif(l == 1) {\n\t\ta = a[0];\n\t\tconst f = isSeq(a) ? seqFoldLeft : iterFoldLeft;\n\t\treturn f(rrb.empty,(acc,a) => acc.push(a))(a);\n\t}\n\treturn a.reduce((acc,a) => acc.push(a),rrb.empty);\n}\n\nexport function join($a) {\n\tif ($a === undefined) return error(\"XPTY0004\");\n\t// assume a sequence of vectors\n\treturn seqFoldLeft(rrb.empty,(pre, cur) => {\n\t\t// TODO force persistent cx\n\t\t//if (list()(cur)) cur = cur.toArray();\n\t\t//if (!isList(cur)) return error(\"XPTY0004\", \"One of the items for array:join is not an array.\");\n\t\treturn rrb.concat(pre, cur);\n\t})($a);\n}\n\n// TODO iterator to Observable using transducer protocol\n// at the completion of the operation, create a new list\n// array:transform($input, ... functions) => zeroOrOne()\n// for now:\nexport function head(a) {\n\treturn rrb.get(a,0);\n}\n\nexport function tail(a) {\n\treturn rrb.slice(a,1);\n}\n\nexport function size(a) {\n\treturn a.count();\n}\n\nexport function subarray(a, s, l) {\n\ts = s - 1;\n\treturn isUndef(l) ?\n\t\trrb.slice(a, s) :\n\t\trrb.slice(a, s, Math.max(s + Number(l), 0));\n}\n\nexport function insertBefore(a, i, v) {\n\ti = i - 1;\n\treturn a.slice(0, i).push(v).concat(a.slice(i));\n}\n\n\nexport function pop(a) {\n\treturn a.pop();\n}\n\nexport function set(a,i,v) {\n\treturn a.set(i,v);\n}\n\nexport function remove(a, i) {\n\treturn a.slice(0, i - 1).concat(a.slice(i));\n}\n\nexport function append(a, v) {\n\treturn a.push(v);\n}\n\nexport function reverse(a) {\n\treturn rrb.fromArray(a.toJS(true).reverse());\n}\n\nexport function flatten(a) {\n\treturn from(a);\n}\n\nexport function filter(a,fn) {\n\treturn seqFilter(flatten(a),fn).reduce((acc,x) => acc.push(x),rrb.empty);\n}\n\nexport function forEach(a,fn) {\n\treturn seqForEach(flatten(a),fn).reduce((acc,x) => acc.push(x),rrb.empty);\n}\n\nexport function get(a, i) {\n\treturn a.size ? a.get(i - 1) : null;\n}\n\nexport function foldLeft(a, z, f) {\n\treturn seqFoldLeft(flatten(a), z, f);\n}\n"],"file":"array.js"}