{"version":3,"sources":["../src/modify.js"],"names":["_isDocOrFrag","node","type","_ascend","cx","child","parent","set","name","inode","firstChild","bind","appendChild","ensureDoc","count","modify","insertChildBefore","ins","removeChild"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;AAEA,MAAMA,YAAY,GAAGC,IAAI,IAAIA,IAAI,CAACC,IAAL,IAAa,CAAb,IAAkBD,IAAI,CAACC,IAAL,IAAa,EAA5D;;AAEA,SAASC,OAAT,CAAiBF,IAAjB,EAAsBG,EAAtB,EAAyB;AACxB,MAAIC,KAAJ;;AACA,SAAOJ,IAAI,CAACK,MAAZ,EAAoB;AACnBD,IAAAA,KAAK,GAAGJ,IAAR;AACAA,IAAAA,IAAI,GAAGA,IAAI,CAACK,MAAZ;AACAL,IAAAA,IAAI,GAAGA,IAAI,CAACM,GAAL,CAASF,KAAK,CAACG,IAAf,EAAoBH,KAAK,CAACI,KAA1B,CAAP;AACA,GANuB,CAOxB;;;AACA,SAAOT,YAAY,CAACC,IAAD,CAAZ,GAAqBS,mBAAWC,IAAX,CAAgBP,EAAhB,EAAoBH,IAApB,CAArB,GAAiDA,IAAxD;AACA;;AAEM,SAASW,WAAT,CAAqBX,IAArB,EAA2BI,KAA3B,EAAkC;AACxC,QAAMD,EAAE,GAAG,QAAQ,WAAW,IAAnB,GAA0B,IAA1B,GAAiCK,UAA5C;AACA,SAAO,oBAAUI,eAAUF,IAAV,CAAeP,EAAf,EAAmBH,IAAnB,CAAV,EAAmC,UAAUA,IAAV,EAAgB;AACzD;AACA,QAAID,YAAY,CAACC,IAAD,CAAZ,IAAsBA,IAAI,CAACa,KAAL,KAAe,CAAzC,EAA4C;AAC3C,aAAO,kBAAM,KAAN,EAAY,sCAAZ,CAAP;AACA;;AACD,WAAO,eAAK,oBAAU,UAAUT,KAAV,EAAiB;AACtC,aAAO,OAAOA,KAAK,CAACI,KAAb,KAAuB,UAAvB,GAAoCJ,KAAK,CAACI,KAAN,CAAYR,IAAZ,CAApC,GAAwD,cAAII,KAAJ,CAA/D;AACA,KAFW,CAAL,EAEJ,mBAAS,UAAUJ,IAAV,EAAgBI,KAAhB,EAAuB;AAClC,aAAOJ,IAAI,CAACc,MAAL,CAAYV,KAAZ,CAAP;AACA,KAFE,EAEAJ,IAFA,CAFI,EAIGI,KAJH,CAAP,CALyD,CAUzD;AACA;AACA;AACA,GAbM,CAAP;AAcA;;AAEM,SAASW,iBAAT,CAA2Bf,IAA3B,EAAgCgB,GAAhC,EAAoC;AAC1C,QAAMb,EAAE,GAAG,QAAQ,WAAW,IAAnB,GAA0B,IAA1B,GAAiCK,UAA5C;AACA,SAAO,oBAAUI,eAAUF,IAAV,CAAeP,EAAf,EAAmBH,IAAnB,CAAV,EAAmC,UAAUA,IAAV,EAAgB;AACzD;AACA,QAAIK,MAAM,GAAGL,IAAI,CAACK,MAAlB;;AACA,QAAG,OAAOW,GAAG,CAACR,KAAX,IAAoB,UAAvB,EAAmC;AAClCQ,MAAAA,GAAG,CAACR,KAAJ,CAAUH,MAAV,EAAiBL,IAAjB;AACA,KAFD,MAEO,CACN;AACA;;AACDA,IAAAA,IAAI,GAAGK,MAAP;AACA,WAAOH,OAAO,CAACF,IAAD,EAAMG,EAAN,CAAd;AACA,GAVM,CAAP;AAWA;;AAEM,SAASc,WAAT,CAAqBjB,IAArB,EAA0BI,KAA1B,EAAgC;AACtC,SAAO,oBAAUQ,eAAUF,IAAV,CAAe,IAAf,EAAqBV,IAArB,CAAV,EAAqCA,IAAI,IAAI;AACnD;AACA;AACA,QAAGI,KAAK,CAACC,MAAN,CAAaG,KAAb,KAAuBR,IAAI,CAACQ,KAA/B,EAAsC;AACtCR,IAAAA,IAAI,GAAGA,IAAI,CAACiB,WAAL,CAAiBb,KAAjB,CAAP;AACA,WAAOF,OAAO,CAACF,IAAD,EAAM,IAAN,CAAd;AACA,GANM,CAAP;AAOA","sourcesContent":["import { seq, switchMap, pipe, foldLeft } from \"./seq\";\n\nimport { inode, ensureDoc } from \"l3n\";\n\nimport { firstChild } from \"./access\";\n\nimport { error } from \"./error\";\n\nconst _isDocOrFrag = node => node.type == 9 || node.type == 11;\n\nfunction _ascend(node,cx){\n\tvar child;\n\twhile (node.parent) {\n\t\tchild = node;\n\t\tnode = node.parent;\n\t\tnode = node.set(child.name,child.inode);\n\t}\n\t// this ensures immutability\n\treturn _isDocOrFrag(node) ? firstChild.bind(cx)(node) : node;\n}\n\nexport function appendChild(node, child) {\n\tconst cx = this && \"vnode\" in this ? this : inode;\n\treturn switchMap(ensureDoc.bind(cx)(node),function (node) {\n\t\t//if(!node || !node.size) return;\n\t\tif (_isDocOrFrag(node) && node.count() > 0) {\n\t\t\treturn error(\"XXX\",\"Document can only contain one child.\");\n\t\t}\n\t\treturn pipe(switchMap(function (child) {\n\t\t\treturn typeof child.inode === \"function\" ? child.inode(node) : seq(child);\n\t\t}),foldLeft(function (node, child) {\n\t\t\treturn node.modify(child);\n\t\t}, node))(child);\n\t\t//.map(node =>\n\t\t//\t(0, _seq.seq)(_ascend(node, cx))\n\t\t//);\n\t});\n}\n\nexport function insertChildBefore(node,ins){\n\tconst cx = this && \"vnode\" in this ? this : inode;\n\treturn switchMap(ensureDoc.bind(cx)(node),function (node) {\n\t\t//if(!node || !node.size) return;\n\t\tlet parent = node.parent;\n\t\tif(typeof ins.inode == \"function\") {\n\t\t\tins.inode(parent,node);\n\t\t} else {\n\t\t\t// what?\n\t\t}\n\t\tnode = parent;\n\t\treturn _ascend(node,cx);\n\t});\n}\n\nexport function removeChild(node,child){\n\treturn switchMap(ensureDoc.bind(this)(node),node => {\n\t\t//if(!node || !node.size || !child) return;\n\t\t// TODO error\n\t\tif(child.parent.inode !== node.inode) return;\n\t\tnode = node.removeChild(child);\n\t\treturn _ascend(node,this);\n\t});\n}\n"],"file":"modify.js"}