{"version":3,"sources":["../src/modify.js"],"names":["_isDocOrFrag","node","type","_ascend","cx","child","parent","set","name","inode","firstChild","bind","appendChild","ensureDoc","count","modify","insertChildBefore","ins","removeChild"],"mappings":";;;;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;AAEA,MAAMA,eAAeC,QAAQA,KAAKC,IAAL,IAAa,CAAb,IAAkBD,KAAKC,IAAL,IAAa,EAA5D;;AAEA,SAASC,OAAT,CAAiBF,IAAjB,EAAsBG,EAAtB,EAAyB;AACxB,MAAIC,KAAJ;;AACA,SAAOJ,KAAKK,MAAZ,EAAoB;AACnBD,YAAQJ,IAAR;AACAA,WAAOA,KAAKK,MAAZ;AACAL,WAAOA,KAAKM,GAAL,CAASF,MAAMG,IAAf,EAAoBH,MAAMI,KAA1B,CAAP;AACA,GANuB,CAOxB;;;AACA,SAAOT,aAAaC,IAAb,IAAqBS,mBAAWC,IAAX,CAAgBP,EAAhB,EAAoBH,IAApB,CAArB,GAAiDA,IAAxD;AACA;;AAEM,SAASW,WAAT,CAAqBX,IAArB,EAA2BI,KAA3B,EAAkC;AACxC,QAAMD,KAAK,QAAQ,WAAW,IAAnB,GAA0B,IAA1B,GAAiCK,UAA5C;AACA,SAAO,oBAAUI,eAAUF,IAAV,CAAeP,EAAf,EAAmBH,IAAnB,CAAV,EAAmC,UAAUA,IAAV,EAAgB;AACzD;AACA,QAAID,aAAaC,IAAb,KAAsBA,KAAKa,KAAL,KAAe,CAAzC,EAA4C;AAC3C,aAAO,kBAAM,KAAN,EAAY,sCAAZ,CAAP;AACA;;AACD,WAAO,eAAK,oBAAU,UAAUT,KAAV,EAAiB;AACtC,aAAO,OAAOA,MAAMI,KAAb,KAAuB,UAAvB,GAAoCJ,MAAMI,KAAN,CAAYR,IAAZ,CAApC,GAAwD,cAAII,KAAJ,CAA/D;AACA,KAFW,CAAL,EAEJ,mBAAS,UAAUJ,IAAV,EAAgBI,KAAhB,EAAuB;AAClC,aAAOJ,KAAKc,MAAL,CAAYV,KAAZ,CAAP;AACA,KAFE,EAEAJ,IAFA,CAFI,EAIGI,KAJH,CAAP,CALyD,CAUzD;AACA;AACA;AACA,GAbM,CAAP;AAcA;;AAEM,SAASW,iBAAT,CAA2Bf,IAA3B,EAAgCgB,GAAhC,EAAoC;AAC1C,QAAMb,KAAK,QAAQ,WAAW,IAAnB,GAA0B,IAA1B,GAAiCK,UAA5C;AACA,SAAO,oBAAUI,eAAUF,IAAV,CAAeP,EAAf,EAAmBH,IAAnB,CAAV,EAAmC,UAAUA,IAAV,EAAgB;AACzD;AACA,QAAIK,SAASL,KAAKK,MAAlB;;AACA,QAAG,OAAOW,IAAIR,KAAX,IAAoB,UAAvB,EAAmC;AAClCQ,UAAIR,KAAJ,CAAUH,MAAV,EAAiBL,IAAjB;AACA,KAFD,MAEO,CACN;AACA;;AACDA,WAAOK,MAAP;AACA,WAAOH,QAAQF,IAAR,EAAaG,EAAb,CAAP;AACA,GAVM,CAAP;AAWA;;AAEM,SAASc,WAAT,CAAqBjB,IAArB,EAA0BI,KAA1B,EAAgC;AACtC,SAAO,oBAAUQ,eAAUF,IAAV,CAAe,IAAf,EAAqBV,IAArB,CAAV,EAAqCA,QAAQ;AACnD;AACA;AACA,QAAGI,MAAMC,MAAN,CAAaG,KAAb,KAAuBR,KAAKQ,KAA/B,EAAsC;AACtCR,WAAOA,KAAKiB,WAAL,CAAiBb,KAAjB,CAAP;AACA,WAAOF,QAAQF,IAAR,EAAa,IAAb,CAAP;AACA,GANM,CAAP;AAOA","sourcesContent":["import { seq, switchMap, pipe, foldLeft } from \"./seq\";\r\n\r\nimport { inode, ensureDoc } from \"l3n\";\r\n\r\nimport { firstChild } from \"./access\";\r\n\r\nimport { error } from \"./error\";\r\n\r\nconst _isDocOrFrag = node => node.type == 9 || node.type == 11;\r\n\r\nfunction _ascend(node,cx){\r\n\tvar child;\r\n\twhile (node.parent) {\r\n\t\tchild = node;\r\n\t\tnode = node.parent;\r\n\t\tnode = node.set(child.name,child.inode);\r\n\t}\r\n\t// this ensures immutability\r\n\treturn _isDocOrFrag(node) ? firstChild.bind(cx)(node) : node;\r\n}\r\n\r\nexport function appendChild(node, child) {\r\n\tconst cx = this && \"vnode\" in this ? this : inode;\r\n\treturn switchMap(ensureDoc.bind(cx)(node),function (node) {\r\n\t\t//if(!node || !node.size) return;\r\n\t\tif (_isDocOrFrag(node) && node.count() > 0) {\r\n\t\t\treturn error(\"XXX\",\"Document can only contain one child.\");\r\n\t\t}\r\n\t\treturn pipe(switchMap(function (child) {\r\n\t\t\treturn typeof child.inode === \"function\" ? child.inode(node) : seq(child);\r\n\t\t}),foldLeft(function (node, child) {\r\n\t\t\treturn node.modify(child);\r\n\t\t}, node))(child);\r\n\t\t//.map(node =>\r\n\t\t//\t(0, _seq.seq)(_ascend(node, cx))\r\n\t\t//);\r\n\t});\r\n}\r\n\r\nexport function insertChildBefore(node,ins){\r\n\tconst cx = this && \"vnode\" in this ? this : inode;\r\n\treturn switchMap(ensureDoc.bind(cx)(node),function (node) {\r\n\t\t//if(!node || !node.size) return;\r\n\t\tlet parent = node.parent;\r\n\t\tif(typeof ins.inode == \"function\") {\r\n\t\t\tins.inode(parent,node);\r\n\t\t} else {\r\n\t\t\t// what?\r\n\t\t}\r\n\t\tnode = parent;\r\n\t\treturn _ascend(node,cx);\r\n\t});\r\n}\r\n\r\nexport function removeChild(node,child){\r\n\treturn switchMap(ensureDoc.bind(this)(node),node => {\r\n\t\t//if(!node || !node.size || !child) return;\r\n\t\t// TODO error\r\n\t\tif(child.parent.inode !== node.inode) return;\r\n\t\tnode = node.removeChild(child);\r\n\t\treturn _ascend(node,this);\r\n\t});\r\n}\r\n"],"file":"modify.js"}